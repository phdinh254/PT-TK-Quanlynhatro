using System;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Windows.Forms;

namespace QuanLyNhaTro.Helpers
{
    public static class UIHelper
    {
        // Định nghĩa màu sắc chuẩn
        public static class Colors
        {
            public static readonly Color Primary = Color.FromArgb(52, 152, 219);      // Xanh dương
            public static readonly Color Secondary = Color.FromArgb(149, 165, 166);   // Xám
            public static readonly Color Success = Color.FromArgb(46, 204, 113);      // Xanh lá
            public static readonly Color Danger = Color.FromArgb(231, 76, 60);        // Đỏ
            public static readonly Color Warning = Color.FromArgb(241, 196, 15);      // Vàng
            public static readonly Color Info = Color.FromArgb(52, 152, 219);         // Xanh dương nhạt
            public static readonly Color Light = Color.FromArgb(236, 240, 241);       // Xám nhạt
            public static readonly Color Dark = Color.FromArgb(52, 73, 94);           // Xám đậm
            public static readonly Color White = Color.White;
            public static readonly Color Black = Color.FromArgb(44, 62, 80);
            public static readonly Color TextPrimary = Color.FromArgb(44, 62, 80);
            public static readonly Color TextSecondary = Color.FromArgb(127, 140, 141);
            public static readonly Color Background = Color.FromArgb(236, 240, 241);
            public static readonly Color CardBackground = Color.White;
        }

        // Định nghĩa font chuẩn
        public static readonly Font DefaultFont = new Font("Times New Roman", 10F, FontStyle.Regular);
        public static readonly Font TitleFont = new Font("Times New Roman", 16F, FontStyle.Bold);
        public static readonly Font HeaderFont = new Font("Times New Roman", 12F, FontStyle.Bold);
        public static readonly Font ButtonFont = new Font("Times New Roman", 10F, FontStyle.Bold);

        public static void ApplyModernStyle(Form form)
        {
            form.BackColor = Colors.Background;
            form.Font = DefaultFont;
        }

        public static void StyleButton(Button button, Color backgroundColor, Color textColor)
        {
            button.BackColor = backgroundColor;
            button.ForeColor = textColor;
            button.FlatStyle = FlatStyle.Flat;
            button.FlatAppearance.BorderSize = 0;
            button.Font = ButtonFont;
            button.Cursor = Cursors.Hand;
            
            // Add rounded corners
            button.Region = CreateRoundedRegion(button.Size, 8);
            
            // Add hover effects
            button.MouseEnter += (s, e) => {
                button.BackColor = ControlPaint.Light(backgroundColor, 0.1f);
            };
            button.MouseLeave += (s, e) => {
                button.BackColor = backgroundColor;
            };
        }

        public static void StylePrimaryButton(Button button)
        {
            StyleButton(button, Colors.Primary, Colors.White);
        }

        public static void StyleSecondaryButton(Button button)
        {
            StyleButton(button, Colors.Secondary, Colors.White);
        }

        public static void StyleDangerButton(Button button)
        {
            StyleButton(button, Colors.Danger, Colors.White);
        }

        public static void StyleWarningButton(Button button)
        {
            StyleButton(button, Colors.Warning, Colors.White);
        }

        public static void StyleTextBox(TextBox textBox)
        {
            textBox.BorderStyle = BorderStyle.FixedSingle;
            textBox.Font = new Font("Segoe UI", 9F);
            textBox.BackColor = Colors.White;
            textBox.ForeColor = Colors.TextPrimary;
        }

        public static void StyleComboBox(ComboBox comboBox)
        {
            comboBox.FlatStyle = FlatStyle.Flat;
            comboBox.Font = new Font("Segoe UI", 9F);
            comboBox.BackColor = Colors.White;
            comboBox.ForeColor = Colors.TextPrimary;
        }

        public static void StyleDataGridView(DataGridView dgv)
        {
            dgv.BackgroundColor = Colors.White;
            dgv.BorderStyle = BorderStyle.None;
            dgv.CellBorderStyle = DataGridViewCellBorderStyle.SingleHorizontal;
            dgv.DefaultCellStyle.SelectionBackColor = Colors.Primary;
            dgv.DefaultCellStyle.SelectionForeColor = Colors.White;
            dgv.DefaultCellStyle.BackColor = Colors.White;
            dgv.DefaultCellStyle.ForeColor = Colors.TextPrimary;
            dgv.DefaultCellStyle.Font = new Font("Segoe UI", 9F);
            dgv.ColumnHeadersDefaultCellStyle.BackColor = Colors.Light;
            dgv.ColumnHeadersDefaultCellStyle.ForeColor = Colors.TextPrimary;
            dgv.ColumnHeadersDefaultCellStyle.Font = new Font("Segoe UI", 9F, FontStyle.Bold);
            dgv.ColumnHeadersBorderStyle = DataGridViewHeaderBorderStyle.None;
            dgv.EnableHeadersVisualStyles = false;
            dgv.GridColor = Colors.Light;
            dgv.RowHeadersVisible = false;
            dgv.SelectionMode = DataGridViewSelectionMode.FullRowSelect;
        }

        public static void StyleGroupBox(GroupBox groupBox)
        {
            groupBox.Font = new Font("Segoe UI", 10F, FontStyle.Bold);
            groupBox.ForeColor = Colors.TextPrimary;
        }

        public static void StyleLabel(Label label, bool isTitle = false)
        {
            if (isTitle)
            {
                label.Font = TitleFont;
                label.ForeColor = Colors.Primary;
            }
            else
            {
                label.Font = new Font("Segoe UI", 9F);
                label.ForeColor = Colors.TextPrimary;
            }
        }

        public static Panel CreateCard(int width, int height)
        {
            Panel card = new Panel
            {
                Size = new Size(width, height),
                BackColor = Colors.CardBackground,
                Padding = new Padding(20)
            };
            
            // Add shadow effect
            card.Paint += (s, e) => {
                Rectangle rect = new Rectangle(0, 0, card.Width - 1, card.Height - 1);
                using (Pen pen = new Pen(Colors.Light, 1))
                {
                    e.Graphics.DrawRectangle(pen, rect);
                }
            };
            
            return card;
        }

        private static Region CreateRoundedRegion(Size size, int radius)
        {
            GraphicsPath path = new GraphicsPath();
            path.AddArc(0, 0, radius, radius, 180, 90);
            path.AddArc(size.Width - radius, 0, radius, radius, 270, 90);
            path.AddArc(size.Width - radius, size.Height - radius, radius, radius, 0, 90);
            path.AddArc(0, size.Height - radius, radius, radius, 90, 90);
            path.CloseAllFigures();
            return new Region(path);
        }

        public static void ShowSuccessMessage(string message, string title = "Thành công")
        {
            MessageBox.Show(message, title, MessageBoxButtons.OK, MessageBoxIcon.Information);
        }

        public static void ShowErrorMessage(string message, string title = "Lỗi")
        {
            MessageBox.Show(message, title, MessageBoxButtons.OK, MessageBoxIcon.Error);
        }

        public static void ShowWarningMessage(string message, string title = "Cảnh báo")
        {
            MessageBox.Show(message, title, MessageBoxButtons.OK, MessageBoxIcon.Warning);
        }

        public static bool ShowConfirmMessage(string message, string title = "Xác nhận")
        {
            return MessageBox.Show(message, title, MessageBoxButtons.YesNo, MessageBoxIcon.Question) == DialogResult.Yes;
        }

        /// <summary>
        /// Chuẩn hóa toàn bộ controls trong form
        /// </summary>
        public static void StandardizeForm(Form form)
        {
            ApplyModernStyle(form);
            StandardizeControls(form.Controls);
        }

        // Kích thước chuẩn
        public static class Sizes
        {
            public const int LabelWidth = 100;
            public const int TextBoxWidth = 180;
            public const int TextBoxHeight = 28;
            public const int ComboBoxWidth = 180;
            public const int ComboBoxHeight = 28;
            public const int ButtonWidth = 100;
            public const int ButtonHeight = 35;
            public const int RowSpacing = 35;
            public const int ColumnSpacing = 20;
            public const int Margin = 15;
        }

        private static void StandardizeControls(Control.ControlCollection controls)
        {
            foreach (Control ctrl in controls)
            {
                // Label
                if (ctrl is Label lbl && !lbl.Name.Contains("Title") && !lbl.Name.Contains("Value") && !lbl.Name.Contains("TongTien"))
                {
                    lbl.Font = new Font("Segoe UI", 9.5F, FontStyle.Regular);
                    lbl.ForeColor = Colors.TextPrimary;
                    lbl.AutoSize = true;
                }

                // TextBox
                if (ctrl is TextBox txt)
                {
                    txt.Font = new Font("Segoe UI", 10F);
                    txt.BorderStyle = BorderStyle.FixedSingle;
                    txt.Height = Sizes.TextBoxHeight;
                    if (txt.Width < 100) txt.Width = Sizes.TextBoxWidth;
                }

                // ComboBox
                if (ctrl is ComboBox cmb)
                {
                    cmb.Font = new Font("Segoe UI", 10F);
                    cmb.FlatStyle = FlatStyle.Flat;
                    cmb.Height = Sizes.ComboBoxHeight;
                    if (cmb.Width < 100) cmb.Width = Sizes.ComboBoxWidth;
                }

                // DateTimePicker
                if (ctrl is DateTimePicker dtp)
                {
                    dtp.Font = new Font("Segoe UI", 10F);
                    dtp.Height = Sizes.TextBoxHeight;
                }

                // Button
                if (ctrl is Button btn)
                {
                    btn.Font = new Font("Segoe UI", 9.5F, FontStyle.Bold);
                    btn.FlatStyle = FlatStyle.Flat;
                    btn.FlatAppearance.BorderSize = 0;
                    btn.Cursor = Cursors.Hand;
                    btn.Height = Sizes.ButtonHeight;
                    if (btn.Width < 80) btn.Width = Sizes.ButtonWidth;
                }

                // GroupBox
                if (ctrl is GroupBox grp)
                {
                    grp.Font = new Font("Segoe UI", 10F, FontStyle.Bold);
                    grp.ForeColor = Colors.Dark;
                    StandardizeControls(grp.Controls);
                }

                // Panel
                if (ctrl is Panel pnl)
                {
                    StandardizeControls(pnl.Controls);
                }

                // FlowLayoutPanel
                if (ctrl is FlowLayoutPanel flp)
                {
                    StandardizeControls(flp.Controls);
                }

                // DataGridView
                if (ctrl is DataGridView dgv)
                {
                    StyleDataGridView(dgv);
                }
            }
        }
    }
}